# Давай вместе (psikhologiya)

Каталог психологов: подбор по парадигме, цене, городу и уровню сертификации. Сайт «Давай вместе» (dvmeste.ru).

---

## Стек

- **Next.js 16** (App Router)
- **Tailwind CSS** — дизайн (primary #5858E2, accent #A7FF5A)
- **Prisma** + **PostgreSQL** — база данных

---

## Быстрый старт

### 1. Установка

```bash
npm install
```

### 2. Переменные окружения

Скопируй `.env.example` в `.env` и заполни:

```bash
cp .env.example .env
```

В `.env` обязательно:

- **DATABASE_URL** — строка подключения к PostgreSQL (обязательно для каталога и админки).
- **NEXT_PUBLIC_BASE_URL** — URL сайта (для SEO и sitemap), например `http://localhost:3000`.

Опционально для админки:

- **ADMIN_LOGIN** — логин (по умолчанию `Gasan123`).
- **ADMIN_PASSWORD** — пароль (по умолчанию `1111`).
- **ADMIN_SESSION_SECRET** — секрет сессии (для продакшена задай свой длинный токен).

### 3. База данных

Подними PostgreSQL (например через Docker):

```bash
docker compose up -d
```

В `.env` укажи свой `DATABASE_URL` (см. `.env.example`).

**Важно:** если видишь ошибки вида **«The column psychologists.workFormat does not exist»** или **«The table public.pages does not exist»**, значит схема БД не совпадает со схемой Prisma. Выполни:

```bash
npx prisma generate
npx prisma db push
```

Либо применить миграции:

```bash
npx prisma migrate deploy
```

После этого все таблицы и колонки появятся в БД.

### 4. Запуск

```bash
npm run dev
```

Открой в браузере:

- Сайт: [http://localhost:3000](http://localhost:3000)
- Админка: [http://localhost:3000/admin](http://localhost:3000/admin)

Без `DATABASE_URL` сайт тоже запустится: каталог будет пустым, страницы психологов и админка могут показывать ошибки или пустые списки.

---

## Админка

- **URL:** `/admin`
- **Логин по умолчанию:** `Gasan123`
- **Пароль по умолчанию:** `1111`

Логин и пароль задаются в `.env` переменными **ADMIN_LOGIN** и **ADMIN_PASSWORD**. Чтобы сменить или «восстановить» доступ — измени эти переменные в `.env` и перезапусти сервер.

В админке:

- **Психологи** — список, добавление, редактирование, удаление анкет. Фото можно добавить по URL или загрузить файл (до 5 фото).
- **Страницы сайта** — список, создание и редактирование страниц (шаблон «текст» или «пустой» HTML). Страницы отображаются по адресу `/s/[slug]`.

---

## Скрипты

| Команда | Описание |
|--------|----------|
| `npm run dev` | Запуск dev-сервера (перед этим вызывается `prisma generate`) |
| `npm run build` | Сборка проекта |
| `npm run start` | Запуск production-сервера |
| `npx prisma db push` | Привести БД в соответствие со схемой Prisma (без миграций) |
| `npx prisma migrate deploy` | Применить миграции |

---

## Маршруты сайта

| Путь | Описание |
|------|----------|
| `/` | Главная |
| `/psy-list` | Каталог психологов (фильтры слева, карточки по центру, модалка по клику) |
| `/psy-list/[slug]` | Профиль психолога |
| `/lib` | Библиотека |
| `/lib/articles` | Статьи |
| `/connect` | Для психологов |
| `/contacts` | Контакты |
| `/certification-levels` | Уровни сертификации |
| `/complaint` | Жалоба |
| `/admin` | Админ-панель (требуется вход) |
| `/admin/login` | Вход в админку |
| `/s/[slug]` | Страницы из БД (текст или свой HTML) |

---

## Загрузка фото в анкету

В форме психолога (добавление/редактирование):

- **Добавить по URL** — введи ссылку на изображение и нажми «Добавить URL».
- **Загрузить файл** — кнопка «Загрузить файл» отправляет изображение на сервер; после загрузки ссылка добавляется в список. Файлы сохраняются в `public/uploads/` (макс. 5 МБ, форматы JPEG, PNG, WebP, GIF).

Первое фото в списке считается основным.

---

## Деплой

1. Собери образ: `docker build -t davay-vmeste .`
2. Запусти контейнер с переменной `DATABASE_URL` и портом 3000.
3. Либо на сервере: `npm run build` и `npm run start` (нужны Node.js и PostgreSQL).

Для продакшена задай в окружении **ADMIN_SESSION_SECRET** (длинная случайная строка) и смени **ADMIN_PASSWORD**.

---

## Структура проекта (кратко)

- **app/** — страницы и маршруты (App Router).
- **app/actions/** — серверные экшены (каталог, статьи).
- **app/api/** — API (например `/api/upload` для загрузки фото).
- **app/admin/** — админка (вход, психологи, страницы).
- **app/catalog/** — логика фильтров и параметров каталога.
- **components/** — UI: блоки главной (`home/`), каталог (`catalog/`), админка (`admin/`), общие (`ui/`, `layout/`).
- **lib/** — БД, авторизация админки, SEO, утилиты.
- **prisma/** — схема БД и миграции.

Код разбит по смыслу: один компонент — одна задача, названия файлов и функций понятные, чтобы было легко ориентироваться новичкам.
