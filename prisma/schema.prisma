// Давай вместе — dvmeste.ru
// PostgreSQL, Prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ---------------------------------------------------------------------------
// Роли админки
// ---------------------------------------------------------------------------

enum Role {
  ADMIN    // всё, включая админов и списки данных
  MANAGER // анкеты, статьи, страницы
}

// ---------------------------------------------------------------------------
// Списки данных (редактирует только Администратор)
// slug: paradigm, certification_level, work_format
// ---------------------------------------------------------------------------

model DataList {
  id        String   @id @default(cuid())
  slug      String   @unique
  name      String
  items     Json     // [{ "label": "...", "order": 0 }]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("data_lists")
}

// ---------------------------------------------------------------------------
// Психолог
// ---------------------------------------------------------------------------

model Psychologist {
  id                   String    @id @default(cuid())
  slug                 String    @unique
  fullName             String
  gender               String
  birthDate            DateTime  @db.Date
  city                 String
  workFormat           String    // из списка данных work_format
  firstDiplomaDate     DateTime? @db.Date
  lastCertificationDate DateTime? @db.Date
  mainParadigm         String[]  // метки из списка paradigm
  certificationLevel   Int       // 1, 2, 3
  shortBio             String   @db.VarChar(400)
  longBio              String   @db.Text
  price                Int
  contactInfo          String   @db.Text
  isPublished          Boolean  @default(false)
  education            Json     // [{ year, type, organization, title, isDiploma }]
  images               String[]
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  articles Article[]

  @@index([isPublished])
  @@index([price])
  @@index([city])
  @@index([certificationLevel])
  @@index([workFormat])
  @@index([isPublished, price])
  @@map("psychologists")
}

// ---------------------------------------------------------------------------
// Статья в библиотеке
// ---------------------------------------------------------------------------

model Article {
  id          String    @id @default(cuid())
  title       String
  slug        String    @unique
  content     String    @db.Text
  tags        String[]
  authorId    String?
  catalogSlug String?   // внутренний каталог, напр. "26/sen"
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  author Psychologist? @relation(fields: [authorId], references: [id], onDelete: SetNull)

  @@index([slug])
  @@index([authorId])
  @@index([publishedAt])
  @@map("articles")
}

// ---------------------------------------------------------------------------
// Страница сайта (текстовая или пустой HTML)
// ---------------------------------------------------------------------------

model Page {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  template  String   // "text" | "empty"
  content   String   @db.Text
  isPublished Boolean @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("pages")
}

// ---------------------------------------------------------------------------
// Пункт меню (дерево)
// ---------------------------------------------------------------------------

model MenuItem {
  id       String   @id @default(cuid())
  label    String
  href     String
  order    Int      @default(0)
  parentId String?
  parent   MenuItem?  @relation("MenuTree", fields: [parentId], references: [id], onDelete: Cascade)
  children MenuItem[] @relation("MenuTree")

  @@map("menu_items")
}
